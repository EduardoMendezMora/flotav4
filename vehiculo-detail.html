<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalle del Vehículo - Flota</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
    <style>
        .vehicle-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        .vehicle-info-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .vehicle-tabs-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .back-button {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        .back-button:hover {
            background: rgba(255,255,255,0.3);
            color: white;
            transform: translateY(-2px);
        }
        .vehicle-status-badge {
            font-size: 1.1rem;
            padding: 0.5rem 1rem;
            border-radius: 25px;
        }
        .vehicle-metric {
            text-align: center;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 10px;
            margin: 0.5rem 0;
        }
        .vehicle-metric-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }
        .vehicle-metric-label {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 0.5rem;
        }
    </style>
</head>
<body>
    <!-- Header del Vehículo -->
    <div class="vehicle-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <a href="index.html" class="back-button mb-3 d-inline-block">
                        <i class="fas fa-arrow-left me-2"></i>Volver a Vehículos
                    </a>
                    <h1 id="vehicle-title" class="mb-2">Cargando...</h1>
                    <div class="d-flex align-items-center gap-3">
                        <span id="vehicle-plate" class="h4 mb-0">-</span>
                        <span id="vehicle-year" class="badge bg-light text-dark">-</span>
                        <span id="vehicle-status" class="vehicle-status-badge bg-success">-</span>
                    </div>
                </div>
                <div class="col-md-4 text-end">
                    <div class="d-flex gap-2 justify-content-end">
                        <button onclick="editVehicle()" class="btn btn-light">
                            <i class="fas fa-edit me-2"></i>Editar
                        </button>
                        <button onclick="deleteVehicle()" class="btn btn-outline-light">
                            <i class="fas fa-trash me-2"></i>Eliminar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Pestañas del Vehículo - Diseño Completo -->
                <div class="vehicle-tabs-container">
                    <div class="card-header bg-white border-bottom">
                <h5 class="mb-0"><i class="fas fa-car me-2"></i>Información Completa del Vehículo</h5>
                    </div>
                    <div class="card-body p-0">
                        <!-- Sistema de Pestañas -->
                        <div class="vehiculo-tabs">
                            <div class="tab-navigation">
                                <button class="tab-button active" data-tab="general">
                                    <i class="fas fa-info-circle"></i>
                                    Información General
                                </button>
                                <button class="tab-button" data-tab="galeria">
                                    <i class="fas fa-images"></i>
                                    Galería
                                </button>
                                <button class="tab-button" data-tab="tareas">
                                    <i class="fas fa-tasks"></i>
                                    Tareas
                                </button>
                                <button class="tab-button" data-tab="inspecciones">
                                    <i class="fas fa-clipboard-check"></i>
                                    Inspecciones
                                </button>
                                <button class="tab-button" data-tab="bitacora">
                                    <i class="fas fa-comments"></i>
                                    Bitácora
                                </button>
                                <button class="tab-button" data-tab="kilometraje">
                                    <i class="fas fa-tachometer-alt"></i>
                                    Kilometraje
                                </button>
                                <button class="tab-button" data-tab="gps">
                                    <i class="fas fa-satellite-dish"></i>
                                    GPS
                                </button>
                                <button class="tab-button" data-tab="repuestos">
                                    <i class="fas fa-tools"></i>
                                    Repuestos
                                </button>
                            </div>

                            <!-- Contenido de las Pestañas -->
                            <div class="tab-content">
                                <!-- Pestaña: Información General -->
                                <div class="tab-pane active" data-tab-pane="general">
                            <div class="tab-content-inner p-4">
                                        <div id="general-tab-content">
                                    <div class="row">
                                        <!-- Información Básica del Vehículo -->
                                        <div class="col-lg-6 mb-4">
                                            <div class="card h-100">
                                                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                                                    <h6 class="mb-0"><i class="fas fa-car me-2"></i>Información Básica</h6>
                                                    <button class="btn btn-sm btn-outline-light" onclick="toggleEditMode('vehicle-info')" id="edit-vehicle-info-btn">
                                                        <i class="fas fa-edit"></i> Editar
                                                    </button>
                                                </div>
                                                <div class="card-body">
                                                    <div class="row">
                                                        <div class="col-6 mb-3">
                                                            <label class="form-label text-muted small">Placa</label>
                                                            <div id="vehicle-placa" class="fw-bold text-primary fs-5">-</div>
                                                            <input type="text" class="form-control form-control-sm d-none" id="edit-vehicle-placa" placeholder="Placa del vehículo">
                                                        </div>
                                                        <div class="col-6 mb-3">
                                                            <label class="form-label text-muted small">VIN</label>
                                                            <div id="vehicle-vin" class="fw-medium">-</div>
                                                            <input type="text" class="form-control form-control-sm d-none" id="edit-vehicle-vin" placeholder="Número VIN" maxlength="17">
                                                        </div>
                                                        <div class="col-6 mb-3">
                                                            <label class="form-label text-muted small">Marca</label>
                                                            <div id="vehicle-brand" class="fw-medium">-</div>
                                                            <select class="form-control form-control-sm d-none" id="edit-vehicle-marca">
                                                                <option value="">Seleccionar marca</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-6 mb-3">
                                                            <label class="form-label text-muted small">Modelo</label>
                                                            <div id="vehicle-model" class="fw-medium">-</div>
                                                            <select class="form-control form-control-sm d-none" id="edit-vehicle-modelo">
                                                                <option value="">Seleccionar modelo</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-6 mb-3">
                                                            <label class="form-label text-muted small">Año</label>
                                                            <div id="vehicle-year-detail" class="fw-medium">-</div>
                                                            <input type="number" class="form-control form-control-sm d-none" id="edit-vehicle-year" placeholder="Año" min="1900" max="2030">
                                                        </div>
                                                        <div class="col-6 mb-3">
                                                            <label class="form-label text-muted small">Color</label>
                                                            <div id="vehicle-color" class="fw-medium">-</div>
                                                            <select class="form-control form-control-sm d-none" id="edit-vehicle-color">
                                                                <option value="">Seleccionar color</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-6 mb-3">
                                                            <label class="form-label text-muted small">Carrocería</label>
                                                            <div id="vehicle-carroceria" class="fw-medium">-</div>
                                                            <select class="form-control form-control-sm d-none" id="edit-vehicle-carroceria">
                                                                <option value="">Seleccionar carrocería</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-6 mb-3">
                                                            <label class="form-label text-muted small">Combustible</label>
                                                            <div id="vehicle-combustible" class="fw-medium">-</div>
                                                            <select class="form-control form-control-sm d-none" id="edit-vehicle-combustible">
                                                                <option value="">Seleccionar combustible</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-6 mb-3">
                                                            <label class="form-label text-muted small">Transmisión</label>
                                                            <div id="vehicle-transmision" class="fw-medium">-</div>
                                                            <select class="form-control form-control-sm d-none" id="edit-vehicle-transmision">
                                                                <option value="">Seleccionar transmisión</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-6 mb-3">
                                                            <label class="form-label text-muted small">Tracción</label>
                                                            <div id="vehicle-traccion" class="fw-medium">-</div>
                                                            <select class="form-control form-control-sm d-none" id="edit-vehicle-traccion">
                                                                <option value="">Seleccionar tracción</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-6 mb-3">
                                                            <label class="form-label text-muted small">Cilindrada (cc)</label>
                                                            <div id="vehicle-cilindrada" class="fw-medium">-</div>
                                                            <input type="number" class="form-control form-control-sm d-none" id="edit-vehicle-cilindrada" placeholder="Cilindrada en cc" min="0">
                                                        </div>
                                                        <div class="col-6 mb-3">
                                                            <label class="form-label text-muted small">Cilindros</label>
                                                            <div id="vehicle-cilindros" class="fw-medium">-</div>
                                                            <input type="number" class="form-control form-control-sm d-none" id="edit-vehicle-cilindros" placeholder="Número de cilindros" min="1" max="16">
                                                        </div>
                                                        <div class="col-12 mb-3">
                                                            <label class="form-label text-muted small">Arrendadora</label>
                                                            <div id="vehicle-arrendadora" class="fw-medium">-</div>
                                                            <select class="form-control form-control-sm d-none" id="edit-vehicle-arrendadora">
                                                                <option value="">Seleccionar arrendadora</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <!-- Botones de acción para edición -->
                                                    <div class="d-none" id="vehicle-info-actions">
                                                        <div class="d-flex gap-2 justify-content-end">
                                                            <button class="btn btn-sm btn-success" onclick="saveVehicleInfo()">
                                                                <i class="fas fa-save"></i> Guardar
                                                            </button>
                                                            <button class="btn btn-sm btn-secondary" onclick="cancelEdit('vehicle-info')">
                                                                <i class="fas fa-times"></i> Cancelar
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Información Financiera -->
                                        <div class="col-lg-6 mb-4">
                                            <div class="card h-100">
                                                <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                                                    <h6 class="mb-0"><i class="fas fa-chart-line me-2"></i>Información Financiera</h6>
                                                    <button class="btn btn-sm btn-outline-light" onclick="toggleEditMode('financial-info')" id="edit-financial-info-btn">
                                                        <i class="fas fa-edit"></i> Editar
                                                    </button>
                                                </div>
                                                <div class="card-body">
                                                    <div class="row">
                                                        <div class="col-6 mb-3">
                                                            <label class="form-label text-muted small">Precio Semanal</label>
                                                            <div id="vehicle-precio-semanal" class="fw-bold text-success fs-5">-</div>
                                                            <input type="number" class="form-control form-control-sm d-none" id="edit-vehicle-precio" placeholder="0.00" step="0.01" min="0">
                                                        </div>
                                                        <div class="col-6 mb-3">
                                                            <label class="form-label text-muted small">Renta Semanal</label>
                                                            <div id="vehicle-renta-semanal" class="fw-bold text-info fs-5">-</div>
                                                            <input type="number" class="form-control form-control-sm d-none" id="edit-vehicle-renta" placeholder="0.00" step="0.01" min="0">
                                                        </div>
                                                        <div class="col-6 mb-3">
                                                            <label class="form-label text-muted small">Plazo (semanas)</label>
                                                            <div id="vehicle-plazo-semanas" class="fw-medium">-</div>
                                                            <input type="number" class="form-control form-control-sm d-none" id="edit-vehicle-plazo" placeholder="0" min="1">
                                                        </div>
                                                        <div class="col-6 mb-3">
                                                            <label class="form-label text-muted small">Gastos Administrativos</label>
                                                            <div id="vehicle-gastos-adms" class="fw-bold text-warning fs-5">-</div>
                                                            <input type="number" class="form-control form-control-sm d-none" id="edit-vehicle-gastos" placeholder="0.00" step="0.01" min="0">
                                                        </div>
                                                        <div class="col-6 mb-3">
                                                            <label class="form-label text-muted small">Valor Adquisición</label>
                                                            <div id="vehicle-valor-adquisicion" class="fw-medium">-</div>
                                                            <input type="number" class="form-control form-control-sm d-none" id="edit-vehicle-valor" placeholder="0.00" step="0.01" min="0">
                                                        </div>
                                                        <div class="col-6 mb-3">
                                                            <label class="form-label text-muted small">Fecha Adquisición</label>
                                                            <div id="vehicle-fecha-adquisicion" class="fw-medium">-</div>
                                                            <input type="date" class="form-control form-control-sm d-none" id="edit-vehicle-fecha-adq">
                                                        </div>
                                                    </div>
                                                    <!-- Botones de acción para edición -->
                                                    <div class="d-none" id="financial-info-actions">
                                                        <div class="d-flex gap-2 justify-content-end">
                                                            <button class="btn btn-sm btn-success" onclick="saveFinancialInfo()">
                                                                <i class="fas fa-save"></i> Guardar
                                                            </button>
                                                            <button class="btn btn-sm btn-secondary" onclick="cancelEdit('financial-info')">
                                                                <i class="fas fa-times"></i> Cancelar
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Información del Cliente y Contactos -->
                                        <div class="col-lg-6 mb-4">
                                            <div class="card h-100">
                                                <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
                                                    <h6 class="mb-0"><i class="fas fa-user me-2"></i>Cliente y Contactos</h6>
                                                    <button class="btn btn-sm btn-outline-light" onclick="toggleEditMode('client-info')" id="edit-client-info-btn">
                                                        <i class="fas fa-edit"></i> Editar
                                                    </button>
                                                </div>
                                                <div class="card-body">
                                                    <div class="row">
                                                        <div class="col-12 mb-3">
                                                            <label class="form-label text-muted small">Cliente Actual</label>
                                                            <div id="vehicle-cliente-actual" class="fw-medium">-</div>
                                                            <input type="text" class="form-control form-control-sm d-none" id="edit-vehicle-cliente" placeholder="Nombre del cliente actual">
                                                        </div>
                                                        <div class="col-6 mb-3">
                                                            <label class="form-label text-muted small">Apoderado</label>
                                                            <div id="vehicle-apoderado" class="fw-medium">-</div>
                                                            <select class="form-control form-control-sm d-none" id="edit-vehicle-apoderado">
                                                                <option value="">Seleccionar apoderado</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-6 mb-3">
                                                            <label class="form-label text-muted small">Vendedor</label>
                                                            <div id="vehicle-vendedor" class="fw-medium">-</div>
                                                            <select class="form-control form-control-sm d-none" id="edit-vehicle-vendedor">
                                                                <option value="">Seleccionar vendedor</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-6 mb-3">
                                                            <label class="form-label text-muted small">Grupo WhatsApp</label>
                                                            <div id="vehicle-whatsapp-grupo" class="fw-medium">-</div>
                                                            <select class="form-control form-control-sm d-none" id="edit-vehicle-whatsapp">
                                                                <option value="">Seleccionar grupo</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-6 mb-3">
                                                            <label class="form-label text-muted small">Grupo WhatsApp (Texto)</label>
                                                            <div id="vehicle-grupo-whatsapp" class="fw-medium">-</div>
                                                            <input type="text" class="form-control form-control-sm d-none" id="edit-vehicle-grupo-whatsapp" placeholder="Grupo de WhatsApp">
                                                        </div>
                                                    </div>
                                                    <!-- Botones de acción para edición -->
                                                    <div class="d-none" id="client-info-actions">
                                                        <div class="d-flex gap-2 justify-content-end">
                                                            <button class="btn btn-sm btn-success" onclick="saveClientInfo()">
                                                                <i class="fas fa-save"></i> Guardar
                                                            </button>
                                                            <button class="btn btn-sm btn-secondary" onclick="cancelEdit('client-info')">
                                                                <i class="fas fa-times"></i> Cancelar
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Estado y Ubicación -->
                                        <div class="col-lg-6 mb-4">
                                            <div class="card h-100">
                                                <div class="card-header bg-warning text-dark d-flex justify-content-between align-items-center">
                                                    <h6 class="mb-0"><i class="fas fa-map-marker-alt me-2"></i>Estado y Ubicación</h6>
                                                    <button class="btn btn-sm btn-outline-dark" onclick="toggleEditMode('status-info')" id="edit-status-info-btn">
                                                        <i class="fas fa-edit"></i> Editar
                                                    </button>
                                                </div>
                                                <div class="card-body">
                                                    <div class="row">
                                                        <div class="col-6 mb-3">
                                                            <label class="form-label text-muted small">Estatus</label>
                                                            <div id="vehicle-estatus" class="fw-medium">-</div>
                                                            <input type="text" class="form-control form-control-sm d-none" id="edit-vehicle-estatus" placeholder="Estatus del vehículo">
                                                        </div>
                                                        <div class="col-6 mb-3">
                                                            <label class="form-label text-muted small">Ubicación</label>
                                                            <div id="vehicle-ubicacion" class="fw-medium">-</div>
                                                            <input type="text" class="form-control form-control-sm d-none" id="edit-vehicle-ubicacion" placeholder="Ubicación actual">
                                                        </div>
                                                        <div class="col-6 mb-3">
                                                            <label class="form-label text-muted small">Estado Actual</label>
                                                            <div id="vehicle-estado-actual" class="fw-medium">-</div>
                                                            <select class="form-control form-control-sm d-none" id="edit-vehicle-estado-actual">
                                                                <option value="">Seleccionar estado actual</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-6 mb-3">
                                                            <label class="form-label text-muted small">Estado Inventario</label>
                                                            <div id="vehicle-estado-inventario" class="fw-medium">-</div>
                                                            <select class="form-control form-control-sm d-none" id="edit-vehicle-estado-inventario">
                                                                <option value="">Seleccionar estado inventario</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-12 mb-3">
                                                            <label class="form-label text-muted small">Link de Fotos</label>
                                                            <div id="vehicle-link-fotos" class="fw-medium">-</div>
                                                            <input type="url" class="form-control form-control-sm d-none" id="edit-vehicle-fotos" placeholder="URL de fotos del vehículo">
                                                        </div>
                                                    </div>
                                                    <!-- Botones de acción para edición -->
                                                    <div class="d-none" id="status-info-actions">
                                                        <div class="d-flex gap-2 justify-content-end">
                                                            <button class="btn btn-sm btn-success" onclick="saveStatusInfo()">
                                                                <i class="fas fa-save"></i> Guardar
                                                            </button>
                                                            <button class="btn btn-sm btn-secondary" onclick="cancelEdit('status-info')">
                                                                <i class="fas fa-times"></i> Cancelar
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Pestaña: Galería -->
                                <div class="tab-pane" data-tab-pane="galeria">
                            <div class="tab-content-inner p-4">
                                <div id="galeria-tab-content" class="galeria-content">
                                    <div class="text-center py-4">
                                        <i class="fas fa-spinner fa-spin fa-2x text-muted"></i>
                                        <p class="mt-2 text-muted">Cargando galería...</p>
                                    </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Pestaña: Tareas -->
                                <div class="tab-pane" data-tab-pane="tareas">
                            <div class="tab-content-inner p-4">
                                <div id="tareas-tab-content" class="tareas-content">
                                    <div class="text-center py-4">
                                        <i class="fas fa-spinner fa-spin fa-2x text-muted"></i>
                                        <p class="mt-2 text-muted">Cargando tareas...</p>
                                    </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Pestaña: Inspecciones -->
                                <div class="tab-pane" data-tab-pane="inspecciones">
                            <div class="tab-content-inner p-4">
                                <div id="inspecciones-tab-content" class="inspecciones-content">
                                    <div class="text-center py-4">
                                        <i class="fas fa-spinner fa-spin fa-2x text-muted"></i>
                                        <p class="mt-2 text-muted">Cargando inspecciones...</p>
                                    </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Pestaña: Bitácora -->
                                <div class="tab-pane" data-tab-pane="bitacora">
                            <div class="tab-content-inner p-4">
                                <div id="bitacora-tab-content" class="bitacora-content">
                                    <div class="text-center py-4">
                                        <i class="fas fa-spinner fa-spin fa-2x text-muted"></i>
                                        <p class="mt-2 text-muted">Cargando bitácora...</p>
                                    </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Pestaña: Kilometraje -->
                                <div class="tab-pane" data-tab-pane="kilometraje">
                            <div class="tab-content-inner p-4">
                                <div id="kilometraje-tab-content" class="kilometraje-content">
                                    <div class="text-center py-4">
                                        <i class="fas fa-spinner fa-spin fa-2x text-muted"></i>
                                        <p class="mt-2 text-muted">Cargando kilometraje...</p>
                                    </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Pestaña: GPS -->
                                <div class="tab-pane" data-tab-pane="gps">
                            <div class="tab-content-inner p-4">
                                <div id="gps-tab-content" class="gps-content">
                                    <div class="text-center py-4">
                                        <i class="fas fa-spinner fa-spin fa-2x text-muted"></i>
                                        <p class="mt-2 text-muted">Cargando dispositivos GPS...</p>
                                    </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Pestaña: Repuestos -->
                                <div class="tab-pane" data-tab-pane="repuestos">
                            <div class="tab-content-inner p-4">
                                <div id="repuestos-tab-content" class="repuestos-content">
                                    <div class="text-center py-4">
                                        <i class="fas fa-spinner fa-spin fa-2x text-muted"></i>
                                        <p class="mt-2 text-muted">Cargando solicitudes de repuestos...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Application Scripts -->
    <script src="config.js"></script>
    <script src="validation.js"></script>
    <script src="api.js"></script>
    <script src="app.js"></script>
    <script src="modals.js"></script>
    <script src="vehiculo-tabs.js"></script>
    
    <script>
        let currentVehicleId = null;
        let currentVehicle = null;

        // Obtener ID del vehículo de la URL
        function getVehicleIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id');
        }

        // Cargar datos del vehículo
        async function loadVehicleData() {
            const vehicleId = getVehicleIdFromUrl();
            if (!vehicleId) {
                console.error('No se encontró ID del vehículo en la URL');
                return;
            }

            currentVehicleId = vehicleId;
            console.log('Cargando vehículo ID:', vehicleId);

            try {
                const vehicle = await api.getVehiculo(vehicleId);
                if (vehicle) {
                    currentVehicle = vehicle;
                    displayVehicleData(vehicle);
                    initializeTabs();
                } else {
                    console.error('No se pudo cargar el vehículo');
                }
            } catch (error) {
                console.error('Error cargando vehículo:', error);
            }
        }

        // Mostrar datos del vehículo
        function displayVehicleData(vehicle) {
            // Título y header
            document.getElementById('vehicle-title').textContent = `${vehicle.marcas?.nombre || 'Sin marca'} ${vehicle.modelos?.nombre || 'Sin modelo'}`;
            document.getElementById('vehicle-plate').textContent = vehicle.placa || 'Sin placa';
            document.getElementById('vehicle-year').textContent = vehicle.anio || 'N/A';
            document.getElementById('vehicle-status').textContent = vehicle.estados_inventario?.nombre || 'Sin estado';

            // Información básica del vehículo
            document.getElementById('vehicle-placa').textContent = vehicle.placa || 'Sin placa';
            document.getElementById('vehicle-vin').textContent = vehicle.vin || 'Sin VIN';
            document.getElementById('vehicle-brand').textContent = vehicle.marcas?.nombre || 'Sin marca';
            document.getElementById('vehicle-model').textContent = vehicle.modelos?.nombre || 'Sin modelo';
            document.getElementById('vehicle-year-detail').textContent = vehicle.anio || 'N/A';
            document.getElementById('vehicle-color').textContent = vehicle.colores?.nombre || 'Sin especificar';
            document.getElementById('vehicle-carroceria').textContent = vehicle.carrocerias?.nombre || 'Sin especificar';
            document.getElementById('vehicle-combustible').textContent = vehicle.combustibles?.nombre || 'Sin especificar';
            document.getElementById('vehicle-transmision').textContent = vehicle.transmisiones?.nombre || 'Sin especificar';
            document.getElementById('vehicle-traccion').textContent = vehicle.tracciones?.nombre || 'Sin especificar';
            document.getElementById('vehicle-cilindrada').textContent = vehicle.cilindrada_cc ? `${vehicle.cilindrada_cc} cc` : 'Sin especificar';
            document.getElementById('vehicle-cilindros').textContent = vehicle.cilindros || 'Sin especificar';
            document.getElementById('vehicle-arrendadora').textContent = vehicle.arrendadoras?.nombre || 'Sin asignar';

            // Información financiera
            document.getElementById('vehicle-precio-semanal').textContent = vehicle.precio_semanal ? api.formatCurrency(vehicle.precio_semanal) : 'N/A';
            document.getElementById('vehicle-renta-semanal').textContent = vehicle.renta_semanal ? api.formatCurrency(vehicle.renta_semanal) : 'N/A';
            document.getElementById('vehicle-plazo-semanas').textContent = vehicle.plazo_semanas || 'N/A';
            document.getElementById('vehicle-gastos-adms').textContent = vehicle.gastos_adms ? api.formatCurrency(vehicle.gastos_adms) : 'N/A';
            document.getElementById('vehicle-valor-adquisicion').textContent = vehicle.valor_adquisicion ? api.formatCurrency(vehicle.valor_adquisicion) : 'N/A';
            document.getElementById('vehicle-fecha-adquisicion').textContent = vehicle.fecha_adquisicion || 'N/A';

            // Información del cliente y contactos
            document.getElementById('vehicle-cliente-actual').textContent = vehicle.cliente_actual || 'Sin asignar';
            document.getElementById('vehicle-apoderado').textContent = vehicle.apoderados?.nombre || 'Sin asignar';
            document.getElementById('vehicle-vendedor').textContent = vehicle.vendedores?.nombre || 'Sin asignar';
            document.getElementById('vehicle-whatsapp-grupo').textContent = vehicle.whatsapp_grupos?.nombre || 'Sin asignar';
            document.getElementById('vehicle-grupo-whatsapp').textContent = vehicle.grupo_whatsapp || 'Sin asignar';

            // Estado y ubicación
            document.getElementById('vehicle-estatus').textContent = vehicle.estatus || 'Sin especificar';
            document.getElementById('vehicle-ubicacion').textContent = vehicle.ubicacion || 'Sin especificar';
            document.getElementById('vehicle-estado-actual').textContent = vehicle.estados_actuales?.nombre || 'Sin especificar';
            document.getElementById('vehicle-estado-inventario').textContent = vehicle.estados_inventario?.nombre || 'Sin especificar';
            document.getElementById('vehicle-link-fotos').textContent = vehicle.link_fotos || 'Sin enlace';
            document.getElementById('vehicle-client-address').textContent = vehicle.cliente_direccion || 'Sin dirección';
            document.getElementById('vehicle-contract-date').textContent = vehicle.fecha_contrato ? new Date(vehicle.fecha_contrato).toLocaleDateString() : 'N/A';
            document.getElementById('vehicle-contract-expiry').textContent = vehicle.fecha_vencimiento ? new Date(vehicle.fecha_vencimiento).toLocaleDateString() : 'N/A';

            // Estado y ubicación
            document.getElementById('vehicle-status-detail').textContent = vehicle.estados_inventario?.nombre || 'Sin estado';
            document.getElementById('vehicle-current-location').textContent = vehicle.ubicacion_actual || 'Sin ubicación';
            document.getElementById('vehicle-last-update').textContent = vehicle.updated_at ? new Date(vehicle.updated_at).toLocaleString() : 'N/A';
            document.getElementById('vehicle-next-maintenance').textContent = vehicle.proximo_mantenimiento ? new Date(vehicle.proximo_mantenimiento).toLocaleDateString() : 'N/A';
            document.getElementById('vehicle-general-notes').textContent = vehicle.observaciones || 'Sin observaciones';

            // Actualizar título de la página
            document.title = `${vehicle.placa} - Detalle del Vehículo - Flota`;
        }

        // Inicializar pestañas
        function initializeTabs() {
            if (window.vehiculoTabsManager) {
                window.vehiculoTabsManager.setVehiculoId(currentVehicleId);
                window.vehiculoTabsManager.initializeTabs();
            }
        }

        // Funciones de botones
        function editVehicle() {
            if (currentVehicle) {
                // Redirigir a la página principal con el modal abierto
                window.location.href = `index.html?edit_vehicle=${currentVehicleId}`;
            }
        }

        function deleteVehicle() {
            if (currentVehicle && confirm(`¿Estás seguro de que quieres eliminar el vehículo ${currentVehicle.placa}?`)) {
                // Implementar eliminación
                console.log('Eliminando vehículo:', currentVehicleId);
            }
        }

        // ========================================
        // FUNCIONALIDAD DE EDICIÓN
        // ========================================
        
        let editMode = {
            'vehicle-info': false,
            'financial-info': false,
            'client-info': false,
            'status-info': false
        };

        // Alternar modo de edición
        function toggleEditMode(section) {
            const isEditing = editMode[section];
            
            if (isEditing) {
                // Cancelar edición
                cancelEdit(section);
            } else {
                // Activar edición
                activateEditMode(section);
            }
        }

        // Activar modo de edición
        function activateEditMode(section) {
            editMode[section] = true;
            
            // Ocultar elementos de visualización y mostrar inputs
            const inputs = document.querySelectorAll(`#${section}-actions`).length > 0 ? 
                document.querySelectorAll(`#${section} input, #${section} select, #${section} textarea`) : 
                document.querySelectorAll(`[id^="edit-vehicle-"]`);
            
            inputs.forEach(input => {
                if (input.id.includes(section.replace('-info', '')) || input.id.includes('edit-vehicle-')) {
                    input.classList.remove('d-none');
                    // Cargar valor actual en el input
                    const displayElement = input.id.replace('edit-', '');
                    const displayEl = document.getElementById(displayElement);
                    if (displayEl && input.type !== 'file') {
                        let value = displayEl.textContent.trim();
                        if (value === '-' || value === 'N/A' || value === 'Sin especificar') {
                            value = '';
                        }
                        input.value = value;
                    }
                    
                    // Cargar valores específicos del vehículo actual
                    if (currentVehicle) {
                        switch (input.id) {
                            case 'edit-vehicle-placa':
                                input.value = currentVehicle.placa || '';
                                break;
                            case 'edit-vehicle-brand':
                            case 'edit-vehicle-marca':
                                input.value = currentVehicle.marca_id || '';
                                break;
                            case 'edit-vehicle-model':
                            case 'edit-vehicle-modelo':
                                input.value = currentVehicle.modelo_id || '';
                                break;
                            case 'edit-vehicle-year':
                                input.value = currentVehicle.anio || '';
                                break;
                            case 'edit-vehicle-color':
                                input.value = currentVehicle.color_id || '';
                                break;
                            case 'edit-vehicle-vin':
                                input.value = currentVehicle.vin || '';
                                break;
                            case 'edit-vehicle-arrendadora':
                                input.value = currentVehicle.arrendadora_id || '';
                                break;
                            case 'edit-vehicle-carroceria':
                                input.value = currentVehicle.carroceria_id || '';
                                break;
                            case 'edit-vehicle-cilindrada':
                                input.value = currentVehicle.cilindrada_cc || '';
                                break;
                            case 'edit-vehicle-cilindros':
                                input.value = currentVehicle.cilindros || '';
                                break;
                            case 'edit-vehicle-combustible':
                                input.value = currentVehicle.combustible_id || '';
                                break;
                            case 'edit-vehicle-transmision':
                                input.value = currentVehicle.transmision_id || '';
                                break;
                            case 'edit-vehicle-traccion':
                                input.value = currentVehicle.traccion_id || '';
                                break;
                            case 'edit-vehicle-precio':
                                input.value = currentVehicle.precio_semanal || '';
                                break;
                            case 'edit-vehicle-plazo':
                                input.value = currentVehicle.plazo_semanas || '';
                                break;
                            case 'edit-vehicle-gastos':
                                input.value = currentVehicle.gastos_adms || '';
                                break;
                            case 'edit-vehicle-valor':
                                input.value = currentVehicle.valor_adquisicion || '';
                                break;
                            case 'edit-vehicle-fecha-adq':
                                input.value = currentVehicle.fecha_adquisicion || '';
                                break;
                            case 'edit-vehicle-estatus':
                                input.value = currentVehicle.estatus || '';
                                break;
                            case 'edit-vehicle-ubicacion':
                                input.value = currentVehicle.ubicacion || '';
                                break;
                            case 'edit-vehicle-estado-actual':
                                input.value = currentVehicle.estado_actual_id || '';
                                break;
                            case 'edit-vehicle-estado-inventario':
                                input.value = currentVehicle.estado_inventario_id || '';
                                break;
                            case 'edit-vehicle-apoderado':
                                input.value = currentVehicle.apoderado_id || '';
                                break;
                            case 'edit-vehicle-vendedor':
                                input.value = currentVehicle.vendedor_id || '';
                                break;
                            case 'edit-vehicle-whatsapp':
                                input.value = currentVehicle.whatsapp_grupo_id || '';
                                break;
                            case 'edit-vehicle-cliente':
                                input.value = currentVehicle.cliente_actual || '';
                                break;
                            case 'edit-vehicle-grupo-whatsapp':
                                input.value = currentVehicle.grupo_whatsapp || '';
                                break;
                            case 'edit-vehicle-fotos':
                                input.value = currentVehicle.link_fotos || '';
                                break;
                        }
                    }
                }
            });

            // Ocultar elementos de visualización
            const displayElements = document.querySelectorAll(`#${section} .fw-medium, #${section} .fw-bold`);
            displayElements.forEach(el => {
                if (!el.id.includes('edit-')) {
                    el.classList.add('d-none');
                }
            });

            // Mostrar botones de acción
            const actionsDiv = document.getElementById(`${section}-actions`);
            if (actionsDiv) {
                actionsDiv.classList.remove('d-none');
            }

            // Cambiar botón de editar
            const editBtn = document.getElementById(`edit-${section}-btn`);
            if (editBtn) {
                editBtn.innerHTML = '<i class="fas fa-times"></i> Cancelar';
                editBtn.classList.remove('btn-outline-light', 'btn-outline-dark');
                editBtn.classList.add('btn-outline-danger');
            }
        }

        // Cancelar edición
        function cancelEdit(section) {
            editMode[section] = false;
            
            // Mostrar elementos de visualización y ocultar inputs
            const inputs = document.querySelectorAll(`#${section} input, #${section} select, #${section} textarea`);
            inputs.forEach(input => {
                input.classList.add('d-none');
            });

            // Mostrar elementos de visualización
            const displayElements = document.querySelectorAll(`#${section} .fw-medium, #${section} .fw-bold`);
            displayElements.forEach(el => {
                if (!el.id.includes('edit-')) {
                    el.classList.remove('d-none');
                }
            });

            // Ocultar botones de acción
            const actionsDiv = document.getElementById(`${section}-actions`);
            if (actionsDiv) {
                actionsDiv.classList.add('d-none');
            }

            // Restaurar botón de editar
            const editBtn = document.getElementById(`edit-${section}-btn`);
            if (editBtn) {
                editBtn.innerHTML = '<i class="fas fa-edit"></i> Editar';
                editBtn.classList.remove('btn-outline-danger');
                if (section === 'status-info') {
                    editBtn.classList.add('btn-outline-dark');
                } else {
                    editBtn.classList.add('btn-outline-light');
                }
            }
        }

        // Guardar información del vehículo
        async function saveVehicleInfo() {
            const data = {
                // Campos básicos del vehículo
                placa: document.getElementById('edit-vehicle-placa')?.value.trim() || currentVehicle?.placa,
                marca_id: document.getElementById('edit-vehicle-marca')?.value || currentVehicle?.marca_id,
                modelo_id: document.getElementById('edit-vehicle-modelo')?.value || currentVehicle?.modelo_id,
                anio: document.getElementById('edit-vehicle-year').value,
                vin: document.getElementById('edit-vehicle-vin').value.trim(),
                arrendadora_id: document.getElementById('edit-vehicle-arrendadora').value,
                
                // Campos de características técnicas
                carroceria_id: document.getElementById('edit-vehicle-carroceria')?.value || currentVehicle?.carroceria_id,
                cilindrada_cc: document.getElementById('edit-vehicle-cilindrada')?.value || currentVehicle?.cilindrada_cc,
                cilindros: document.getElementById('edit-vehicle-cilindros')?.value || currentVehicle?.cilindros,
                combustible_id: document.getElementById('edit-vehicle-combustible')?.value || currentVehicle?.combustible_id,
                transmision_id: document.getElementById('edit-vehicle-transmision')?.value || currentVehicle?.transmision_id,
                traccion_id: document.getElementById('edit-vehicle-traccion')?.value || currentVehicle?.traccion_id,
                color_id: document.getElementById('edit-vehicle-color')?.value || currentVehicle?.color_id,
                
                // Campos financieros
                precio_semanal: document.getElementById('edit-vehicle-precio')?.value || currentVehicle?.precio_semanal,
                plazo_semanas: document.getElementById('edit-vehicle-plazo')?.value || currentVehicle?.plazo_semanas,
                gastos_adms: document.getElementById('edit-vehicle-gastos')?.value || currentVehicle?.gastos_adms,
                valor_adquisicion: document.getElementById('edit-vehicle-valor')?.value || currentVehicle?.valor_adquisicion,
                fecha_adquisicion: document.getElementById('edit-vehicle-fecha-adq')?.value || currentVehicle?.fecha_adquisicion,
                
                // Campos de estado
                estatus: document.getElementById('edit-vehicle-estatus')?.value || currentVehicle?.estatus,
                ubicacion: document.getElementById('edit-vehicle-ubicacion')?.value || currentVehicle?.ubicacion,
                estado_actual_id: document.getElementById('edit-vehicle-estado-actual')?.value || currentVehicle?.estado_actual_id,
                estado_inventario_id: document.getElementById('edit-vehicle-estado-inventario')?.value || currentVehicle?.estado_inventario_id,
                
                // Campos adicionales
                apoderado_id: document.getElementById('edit-vehicle-apoderado')?.value || currentVehicle?.apoderado_id,
                vendedor_id: document.getElementById('edit-vehicle-vendedor')?.value || currentVehicle?.vendedor_id,
                whatsapp_grupo_id: document.getElementById('edit-vehicle-whatsapp')?.value || currentVehicle?.whatsapp_grupo_id,
                cliente_actual: document.getElementById('edit-vehicle-cliente')?.value || currentVehicle?.cliente_actual,
                grupo_whatsapp: document.getElementById('edit-vehicle-grupo-whatsapp')?.value || currentVehicle?.grupo_whatsapp,
                link_fotos: document.getElementById('edit-vehicle-fotos')?.value || currentVehicle?.link_fotos
            };

            // Validación de campos requeridos
            if (!data.placa) {
                showError('La placa es requerida');
                const placaField = document.getElementById('edit-vehicle-placa');
                if (placaField) placaField.focus();
                return;
            }

            if (!data.marca_id) {
                showError('La marca es requerida');
                const marcaField = document.getElementById('edit-vehicle-marca') || document.getElementById('edit-vehicle-brand');
                if (marcaField) marcaField.focus();
                return;
            }

            if (!data.modelo_id) {
                showError('El modelo es requerido');
                const modeloField = document.getElementById('edit-vehicle-modelo') || document.getElementById('edit-vehicle-model');
                if (modeloField) modeloField.focus();
                return;
            }

            if (!data.anio || data.anio < 1900 || data.anio > new Date().getFullYear() + 2) {
                showError('El año debe estar entre 1900 y ' + (new Date().getFullYear() + 2));
                document.getElementById('edit-vehicle-year').focus();
                return;
            }

            // Validación de VIN si se proporciona
            if (data.vin && !api.validateVIN(data.vin)) {
                showError('Formato de VIN inválido. Debe tener 17 caracteres alfanuméricos.');
                document.getElementById('edit-vehicle-vin').focus();
                return;
            }

            try {
                // Mostrar indicador de carga
                const saveBtn = document.querySelector('#vehicle-info-actions .btn-success');
                const originalText = saveBtn.innerHTML;
                saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Guardando...';
                saveBtn.disabled = true;

                const response = await api.updateVehiculo(currentVehicleId, data);
                if (response.success) {
                    // Recargar los datos del vehículo para obtener la información actualizada
                    await loadVehicleData();
                    
                    cancelEdit('vehicle-info');
                    showSuccess('Información del vehículo actualizada correctamente');
                } else {
                    showError('Error al actualizar: ' + response.error);
                }
            } catch (error) {
                showError('Error al guardar los cambios: ' + error.message);
                console.error('Error:', error);
            } finally {
                // Restaurar botón
                const saveBtn = document.querySelector('#vehicle-info-actions .btn-success');
                if (saveBtn) {
                    saveBtn.innerHTML = originalText;
                    saveBtn.disabled = false;
                }
            }
        }

        // Guardar información financiera
        async function saveFinancialInfo() {
            const data = {
                precio_semanal: document.getElementById('edit-vehicle-price').value,
                gastos_adms: document.getElementById('edit-vehicle-expenses').value,
                valor_comercial: document.getElementById('edit-vehicle-commercial-value').value,
                valor_residual: document.getElementById('edit-vehicle-residual-value').value,
                observaciones_financieras: document.getElementById('edit-vehicle-financial-notes').value
            };

            try {
                const response = await api.updateVehiculo(currentVehicleId, data);
                if (response.success) {
                    // Actualizar la visualización
                    document.getElementById('vehicle-price').textContent = data.precio_semanal ? api.formatCurrency(data.precio_semanal) : 'N/A';
                    document.getElementById('vehicle-expenses').textContent = data.gastos_adms ? api.formatCurrency(data.gastos_adms) : 'N/A';
                    document.getElementById('vehicle-commercial-value').textContent = data.valor_comercial ? api.formatCurrency(data.valor_comercial) : 'N/A';
                    document.getElementById('vehicle-residual-value').textContent = data.valor_residual ? api.formatCurrency(data.valor_residual) : 'N/A';
                    document.getElementById('vehicle-financial-notes').textContent = data.observaciones_financieras || 'Sin observaciones';
                    
                    cancelEdit('financial-info');
                    showSuccess('Información financiera actualizada correctamente');
                } else {
                    showError('Error al actualizar: ' + response.error);
                }
            } catch (error) {
                showError('Error al guardar los cambios');
                console.error('Error:', error);
            }
        }

        // Guardar información del cliente
        async function saveClientInfo() {
            const data = {
                cliente_nombre: document.getElementById('edit-vehicle-client-name').value,
                cliente_telefono: document.getElementById('edit-vehicle-client-phone').value,
                cliente_email: document.getElementById('edit-vehicle-client-email').value,
                cliente_direccion: document.getElementById('edit-vehicle-client-address').value,
                fecha_contrato: document.getElementById('edit-vehicle-contract-date').value,
                fecha_vencimiento: document.getElementById('edit-vehicle-contract-expiry').value
            };

            try {
                const response = await api.updateVehiculo(currentVehicleId, data);
                if (response.success) {
                    // Actualizar la visualización
                    document.getElementById('vehicle-client-name').textContent = data.cliente_nombre || 'Sin asignar';
                    document.getElementById('vehicle-client-phone').textContent = data.cliente_telefono || 'Sin teléfono';
                    document.getElementById('vehicle-client-email').textContent = data.cliente_email || 'Sin email';
                    document.getElementById('vehicle-client-address').textContent = data.cliente_direccion || 'Sin dirección';
                    document.getElementById('vehicle-contract-date').textContent = data.fecha_contrato ? new Date(data.fecha_contrato).toLocaleDateString() : 'N/A';
                    document.getElementById('vehicle-contract-expiry').textContent = data.fecha_vencimiento ? new Date(data.fecha_vencimiento).toLocaleDateString() : 'N/A';
                    
                    cancelEdit('client-info');
                    showSuccess('Información del cliente actualizada correctamente');
                } else {
                    showError('Error al actualizar: ' + response.error);
                }
            } catch (error) {
                showError('Error al guardar los cambios');
                console.error('Error:', error);
            }
        }

        // Guardar información de estado
        async function saveStatusInfo() {
            const data = {
                estado: document.getElementById('edit-vehicle-status').value,
                ubicacion_actual: document.getElementById('edit-vehicle-current-location').value,
                ultima_actualizacion: document.getElementById('edit-vehicle-last-update').value,
                proximo_mantenimiento: document.getElementById('edit-vehicle-next-maintenance').value,
                observaciones: document.getElementById('edit-vehicle-general-notes').value
            };

            try {
                const response = await api.updateVehiculo(currentVehicleId, data);
                if (response.success) {
                    // Actualizar la visualización
                    document.getElementById('vehicle-status-detail').textContent = data.estado || 'Sin estado';
                    document.getElementById('vehicle-current-location').textContent = data.ubicacion_actual || 'Sin ubicación';
                    document.getElementById('vehicle-last-update').textContent = data.ultima_actualizacion ? new Date(data.ultima_actualizacion).toLocaleString() : 'N/A';
                    document.getElementById('vehicle-next-maintenance').textContent = data.proximo_mantenimiento ? new Date(data.proximo_mantenimiento).toLocaleDateString() : 'N/A';
                    document.getElementById('vehicle-general-notes').textContent = data.observaciones || 'Sin observaciones';
                    
                    cancelEdit('status-info');
                    showSuccess('Información de estado actualizada correctamente');
                } else {
                    showError('Error al actualizar: ' + response.error);
                }
            } catch (error) {
                showError('Error al guardar los cambios');
                console.error('Error:', error);
            }
        }

        // Funciones de utilidad para mostrar mensajes
        function showSuccess(message) {
            if (window.app && window.app.showToast) {
                window.app.showToast(message, 'success');
            } else {
                alert('✅ ' + message);
            }
        }

        function showError(message) {
            if (window.app && window.app.showToast) {
                window.app.showToast(message, 'error');
            } else {
                alert('❌ ' + message);
            }
        }

        // Cargar opciones para selects
        async function loadSelectOptions() {
            try {
                // Cargar marcas
                const marcasResponse = await api.getMarcas();
                if (marcasResponse.success && marcasResponse.data) {
                    const marcaSelect = document.getElementById('edit-vehicle-marca') || document.getElementById('edit-vehicle-brand');
                    if (marcaSelect) {
                        marcaSelect.innerHTML = '<option value="">Seleccionar marca</option>';
                        marcasResponse.data.forEach(marca => {
                            marcaSelect.innerHTML += `<option value="${marca.id}">${marca.nombre}</option>`;
                        });
                    }
                }

                // Cargar arrendadoras
                const arrendadorasResponse = await api.getArrendadoras();
                if (arrendadorasResponse.success && arrendadorasResponse.data) {
                    const arrendadoraSelect = document.getElementById('edit-vehicle-arrendadora');
                    if (arrendadoraSelect) {
                        arrendadoraSelect.innerHTML = '<option value="">Seleccionar arrendadora</option>';
                        arrendadorasResponse.data.forEach(arrendadora => {
                            arrendadoraSelect.innerHTML += `<option value="${arrendadora.id}">${arrendadora.nombre}</option>`;
                        });
                    }
                }

                // Cargar carrocerías
                const carroceriasResponse = await api.getCarrocerias();
                if (carroceriasResponse.success && carroceriasResponse.data) {
                    const carroceriaSelect = document.getElementById('edit-vehicle-carroceria');
                    if (carroceriaSelect) {
                        carroceriaSelect.innerHTML = '<option value="">Seleccionar carrocería</option>';
                        carroceriasResponse.data.forEach(carroceria => {
                            carroceriaSelect.innerHTML += `<option value="${carroceria.id}">${carroceria.nombre}</option>`;
                        });
                    }
                }

                // Cargar colores
                const coloresResponse = await api.getColores();
                if (coloresResponse.success && coloresResponse.data) {
                    const colorSelect = document.getElementById('edit-vehicle-color');
                    if (colorSelect) {
                        colorSelect.innerHTML = '<option value="">Seleccionar color</option>';
                        coloresResponse.data.forEach(color => {
                            colorSelect.innerHTML += `<option value="${color.id}">${color.nombre}</option>`;
                        });
                    }
                }

                // Cargar combustibles
                const combustiblesResponse = await api.getCombustibles();
                if (combustiblesResponse.success && combustiblesResponse.data) {
                    const combustibleSelect = document.getElementById('edit-vehicle-combustible');
                    if (combustibleSelect) {
                        combustibleSelect.innerHTML = '<option value="">Seleccionar combustible</option>';
                        combustiblesResponse.data.forEach(combustible => {
                            combustibleSelect.innerHTML += `<option value="${combustible.id}">${combustible.nombre}</option>`;
                        });
                    }
                }

                // Cargar transmisiones
                const transmisionesResponse = await api.getTransmisiones();
                if (transmisionesResponse.success && transmisionesResponse.data) {
                    const transmisionSelect = document.getElementById('edit-vehicle-transmision');
                    if (transmisionSelect) {
                        transmisionSelect.innerHTML = '<option value="">Seleccionar transmisión</option>';
                        transmisionesResponse.data.forEach(transmision => {
                            transmisionSelect.innerHTML += `<option value="${transmision.id}">${transmision.nombre}</option>`;
                        });
                    }
                }

                // Cargar tracciones
                const traccionesResponse = await api.getTracciones();
                if (traccionesResponse.success && traccionesResponse.data) {
                    const traccionSelect = document.getElementById('edit-vehicle-traccion');
                    if (traccionSelect) {
                        traccionSelect.innerHTML = '<option value="">Seleccionar tracción</option>';
                        traccionesResponse.data.forEach(traccion => {
                            traccionSelect.innerHTML += `<option value="${traccion.id}">${traccion.nombre}</option>`;
                        });
                    }
                }

                // Cargar estados actuales
                const estadosActualesResponse = await api.getEstadosActuales();
                if (estadosActualesResponse.success && estadosActualesResponse.data) {
                    const estadoActualSelect = document.getElementById('edit-vehicle-estado-actual');
                    if (estadoActualSelect) {
                        estadoActualSelect.innerHTML = '<option value="">Seleccionar estado actual</option>';
                        estadosActualesResponse.data.forEach(estado => {
                            estadoActualSelect.innerHTML += `<option value="${estado.id}">${estado.nombre}</option>`;
                        });
                    }
                }

                // Cargar estados de inventario
                const estadosInventarioResponse = await api.getEstadosInventario();
                if (estadosInventarioResponse.success && estadosInventarioResponse.data) {
                    const estadoInventarioSelect = document.getElementById('edit-vehicle-estado-inventario');
                    if (estadoInventarioSelect) {
                        estadoInventarioSelect.innerHTML = '<option value="">Seleccionar estado de inventario</option>';
                        estadosInventarioResponse.data.forEach(estado => {
                            estadoInventarioSelect.innerHTML += `<option value="${estado.id}">${estado.nombre}</option>`;
                        });
                    }
                }

                // Cargar vendedores
                const vendedoresResponse = await api.getVendedores();
                if (vendedoresResponse.success && vendedoresResponse.data) {
                    const vendedorSelect = document.getElementById('edit-vehicle-vendedor');
                    if (vendedorSelect) {
                        vendedorSelect.innerHTML = '<option value="">Seleccionar vendedor</option>';
                        vendedoresResponse.data.forEach(vendedor => {
                            vendedorSelect.innerHTML += `<option value="${vendedor.id}">${vendedor.nombre}</option>`;
                        });
                    }
                }

                // Cargar grupos de WhatsApp
                const whatsappGruposResponse = await api.getWhatsappGrupos();
                if (whatsappGruposResponse.success && whatsappGruposResponse.data) {
                    const whatsappSelect = document.getElementById('edit-vehicle-whatsapp');
                    if (whatsappSelect) {
                        whatsappSelect.innerHTML = '<option value="">Seleccionar grupo WhatsApp</option>';
                        whatsappGruposResponse.data.forEach(grupo => {
                            whatsappSelect.innerHTML += `<option value="${grupo.id}">${grupo.nombre}</option>`;
                        });
                    }
                }

                // Cargar apoderados
                const apoderadosResponse = await api.getApoderados();
                if (apoderadosResponse.success && apoderadosResponse.data) {
                    const apoderadoSelect = document.getElementById('edit-vehicle-apoderado');
                    if (apoderadoSelect) {
                        apoderadoSelect.innerHTML = '<option value="">Seleccionar apoderado</option>';
                        apoderadosResponse.data.forEach(apoderado => {
                            apoderadoSelect.innerHTML += `<option value="${apoderado.id}">${apoderado.nombre}</option>`;
                        });
                    }
                }

            } catch (error) {
                console.error('Error cargando opciones de selects:', error);
            }
        }

        // Cargar datos cuando se carga la página
        window.addEventListener('load', function() {
            loadVehicleData();
            loadSelectOptions();
        });
    </script>
</body>
</html>
